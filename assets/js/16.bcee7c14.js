(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{202:function(t,a,s){"use strict";s.r(a);var e=s(0),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("在 iOS 中并发编程除了经常使用的 GCD 外还可以使用 NSOperation。与 GCD 相比 NSOperation 是面向对象的，所以更加易于使用，而且 NSOperation 包含了一些 GCD 较难实现的功能，也是苹果推荐的方式。\n")]),t._v(" "),s("p",[t._v("NSOperation 的主要使用方式就是将操作添加到队列中，而 NSOperation 本身是个抽象类，其只有方法声明并没有实现，所以我们需要使用其子类来创建操作")]),t._v(" "),s("h2",{attrs:{id:"创建操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建操作"}},[t._v("#")]),t._v(" 创建操作")]),t._v(" "),s("p",[t._v("NSOperation 创建的操作默认都是异步执行的，可以通过调用  "),s("code",[t._v("start")]),t._v("  方法在当前线程立即执行操作")]),t._v(" "),s("h3",{attrs:{id:"使用-nsinvocationoperation-创建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-nsinvocationoperation-创建"}},[t._v("#")]),t._v(" 使用 NSInvocationOperation 创建")]),t._v(" "),s("p",[t._v("下面的例子中  "),s("code",[t._v("demo")]),t._v("  是一个普通的方法，NSInvocationOperation 只能在 Objective-C 中使用，Swift 已经移除了这种方法")]),t._v(" "),s("div",{staticClass:"language-objectivec line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-objectivec"}},[s("code",[t._v("NSInvocationOperation "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("operation "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NSInvocationOperation alloc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" initWithTarget"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),t._v(" selector"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("@selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("demo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" object"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("nil"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在当前线程立即执行操作")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("operation start"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("h3",{attrs:{id:"使用-nsblockoperation-创建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-nsblockoperation-创建"}},[t._v("#")]),t._v(" 使用 NSBlockOperation 创建")]),t._v(" "),s("tabs",{attrs:{"cache-lifetime":"10",options:{useUrlFragment:!1}}},[s("tab",{attrs:{name:"Objective-C",id:"first-tab"}},[s("div",{staticClass:"language-objectivec line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-objectivec"}},[s("code",[t._v("NSBlockOperation "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("operation "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NSBlockOperation blockOperationWithBlock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 操作 ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])])]),t._v(" "),s("tab",{attrs:{name:"Swift",id:"second-tab"}},[s("div",{staticClass:"language-swift line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-swift"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" operation "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("BlockOperation")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 操作 ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])])])],1),t._v(" "),s("p",[t._v("我们可以通过  "),s("code",[t._v("addExecutionBlock")]),t._v("  给 NSBlockOperation 添加多个操作，这多个操作是异步执行的")]),t._v(" "),s("tabs",{attrs:{"cache-lifetime":"10",options:{useUrlFragment:!1}}},[s("tab",{attrs:{name:"Objective-C",id:"first-tab"}},[s("div",{staticClass:"language-objectivec line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-objectivec"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("operation addExecutionBlock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 操作 ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])])]),t._v(" "),s("tab",{attrs:{name:"Swift",id:"second-tab"}},[s("div",{staticClass:"language-swift line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-swift"}},[s("code",[t._v("operation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("addExecutionBlock "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 操作")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])])])],1),t._v(" "),s("h3",{attrs:{id:"变更操作优先级"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#变更操作优先级"}},[t._v("#")]),t._v(" 变更操作优先级")]),t._v(" "),s("p",[t._v("我们可以通过设置  "),s("code",[t._v("queuePriority")]),t._v("  设置操作的优先级，通过设置  "),s("code",[t._v("qualityOfService")]),t._v("  设置操作的服务质量即系统分配资源的数量")]),t._v(" "),s("tabs",{attrs:{"cache-lifetime":"10",options:{useUrlFragment:!1}}},[s("tab",{attrs:{name:"Objective-C",id:"first-tab"}},[s("div",{staticClass:"language-objectivec line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-objectivec"}},[s("code",[t._v("operation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("queuePriority "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" NSOperationQueuePriorityHigh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\noperation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("qualityOfService "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" NSOperationQualityOfServiceUserInteractive"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])])]),t._v(" "),s("tab",{attrs:{name:"Swift",id:"second-tab"}},[s("div",{staticClass:"language-swift line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-swift"}},[s("code",[t._v("operation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("queuePriority "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("high\noperation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("qualityOfService "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("userInteractive\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])])])],1),t._v(" "),s("h3",{attrs:{id:"操作完成回调"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#操作完成回调"}},[t._v("#")]),t._v(" 操作完成回调")]),t._v(" "),s("p",[t._v("我们可以给操作设置回调函数，可以在操作执行完毕时执行")]),t._v(" "),s("tabs",{attrs:{"cache-lifetime":"10",options:{useUrlFragment:!1}}},[s("tab",{attrs:{name:"Objective-C",id:"first-tab"}},[s("div",{staticClass:"language-objectivec line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-objectivec"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("operation setCompletionBlock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 操作结束时回调")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])])]),t._v(" "),s("tab",{attrs:{name:"Swift",id:"second-tab"}},[s("div",{staticClass:"language-swift line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-swift"}},[s("code",[t._v("operation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("completionBlock "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 操作结束时回调")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])])])],1),t._v(" "),s("h2",{attrs:{id:"创建队列"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建队列"}},[t._v("#")]),t._v(" 创建队列")]),t._v(" "),s("p",[t._v("我们可以通过 NSOperationQueue 创建队列，将操作放入队列中运行。队列默认是并行的，我们可以通过将"),s("a",{attrs:{href:"#%E6%9C%80%E5%A4%A7%E5%B9%B6%E5%8F%91%E6%95%B0"}},[t._v("最大并发数")]),t._v("设置为 1 来让队列变为串行")]),t._v(" "),s("tabs",{attrs:{"cache-lifetime":"10",options:{useUrlFragment:!1}}},[s("tab",{attrs:{name:"Objective-C",id:"first-tab"}},[s("div",{staticClass:"language-objectivec line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-objectivec"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建队列")]),t._v("\nNSOperationQueue "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("queue "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NSOperationQueue alloc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" init"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 向队列添加一个操作")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("queue addOperation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("operation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])])]),t._v(" "),s("tab",{attrs:{name:"Swift",id:"second-tab"}},[s("div",{staticClass:"language-swift line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-swift"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建队列")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" queue "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("OperationQueue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 向队列添加一个操作")]),t._v("\nqueue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addOperation")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("operation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])])])],1),t._v(" "),s("p",[t._v("对于 NSBlockOperation 我们可以通过下面的方式直接向队列添加操作而无需单独创建")]),t._v(" "),s("tabs",{attrs:{"cache-lifetime":"10",options:{useUrlFragment:!1}}},[s("tab",{attrs:{name:"Objective-C",id:"first-tab"}},[s("div",{staticClass:"language-objectivec line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-objectivec"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建队列")]),t._v("\nNSOperationQueue "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("queue "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NSOperationQueue alloc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" init"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 向队列添加一个操作")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("queue addOperationWithBlock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 操作")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])])]),t._v(" "),s("tab",{attrs:{name:"Swift",id:"second-tab"}},[s("div",{staticClass:"language-swift line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-swift"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建队列")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" queue "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("OperationQueue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 向队列添加一个操作")]),t._v("\nqueue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("addOperation "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 操作")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])])])],1),t._v(" "),s("h3",{attrs:{id:"主队列"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#主队列"}},[t._v("#")]),t._v(" 主队列")]),t._v(" "),s("p",[t._v("我们可以通过下面的方式获得主队列，主队列是串行队列")]),t._v(" "),s("tabs",{attrs:{"cache-lifetime":"10",options:{useUrlFragment:!1}}},[s("tab",{attrs:{name:"Objective-C",id:"first-tab"}},[s("div",{staticClass:"language-objectivec line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-objectivec"}},[s("code",[t._v("NSOperationQueue "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("queue "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NSOperationQueue mainQueue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])])]),t._v(" "),s("tab",{attrs:{name:"Swift",id:"second-tab"}},[s("div",{staticClass:"language-swift line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-swift"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" queue "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("OperationQueue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("main\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])])])],1),t._v(" "),s("h3",{attrs:{id:"最大并发数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#最大并发数"}},[t._v("#")]),t._v(" 最大并发数")]),t._v(" "),s("p",[t._v("我们可以通过设置队列的  "),s("code",[t._v("maxConcurrentOperationCount")]),t._v("  参数来设置最大并发数，当该值设置为 1 时队列将以串行方式运行")]),t._v(" "),s("tabs",{attrs:{"cache-lifetime":"10",options:{useUrlFragment:!1}}},[s("tab",{attrs:{name:"Objective-C",id:"first-tab"}},[s("div",{staticClass:"language-objectivec line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-objectivec"}},[s("code",[t._v("queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("maxConcurrentOperationCount "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])])]),t._v(" "),s("tab",{attrs:{name:"Swift",id:"second-tab"}},[s("div",{staticClass:"language-swift line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-swift"}},[s("code",[t._v("queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("maxConcurrentOperationCount "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])])])],1),t._v(" "),s("h2",{attrs:{id:"队列的暂停、继续与取消"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#队列的暂停、继续与取消"}},[t._v("#")]),t._v(" 队列的暂停、继续与取消")]),t._v(" "),s("p",[t._v("我们只能暂停与取消队列中还未执行的操作，正在执行的操作不受影响")]),t._v(" "),s("h3",{attrs:{id:"队列暂停"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#队列暂停"}},[t._v("#")]),t._v(" 队列暂停")]),t._v(" "),s("tabs",{attrs:{"cache-lifetime":"10",options:{useUrlFragment:!1}}},[s("tab",{attrs:{name:"Objective-C",id:"first-tab"}},[s("div",{staticClass:"language-objectivec line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-objectivec"}},[s("code",[t._v("queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("suspended "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" YES"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])])]),t._v(" "),s("tab",{attrs:{name:"Swift",id:"second-tab"}},[s("div",{staticClass:"language-swift line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-swift"}},[s("code",[t._v("queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isSuspended "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])])])],1),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),s("p",[t._v("如果先暂停队列，再添加操作到队列，队列不会调度添加的操作。所以在暂停队列之前要判断队列中有没有任务，如果没有任务就不暂停队列。")])]),t._v(" "),s("h3",{attrs:{id:"队列继续"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#队列继续"}},[t._v("#")]),t._v(" 队列继续")]),t._v(" "),s("tabs",{attrs:{"cache-lifetime":"10",options:{useUrlFragment:!1}}},[s("tab",{attrs:{name:"Objective-C",id:"first-tab"}},[s("div",{staticClass:"language-objectivec line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-objectivec"}},[s("code",[t._v("queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("suspended "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" NO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])])]),t._v(" "),s("tab",{attrs:{name:"Swift",id:"second-tab"}},[s("div",{staticClass:"language-swift line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-swift"}},[s("code",[t._v("queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isSuspended "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])])])],1),t._v(" "),s("h3",{attrs:{id:"队列取消"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#队列取消"}},[t._v("#")]),t._v(" 队列取消")]),t._v(" "),s("tabs",{attrs:{"cache-lifetime":"10",options:{useUrlFragment:!1}}},[s("tab",{attrs:{name:"Objective-C",id:"first-tab"}},[s("div",{staticClass:"language-objectivec line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-objectivec"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("queue cancelAllOperations"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])])]),t._v(" "),s("tab",{attrs:{name:"Swift",id:"second-tab"}},[s("div",{staticClass:"language-swift line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-swift"}},[s("code",[t._v("queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cancelAllOperations")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])])])],1),t._v(" "),s("h2",{attrs:{id:"操作依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#操作依赖"}},[t._v("#")]),t._v(" 操作依赖")]),t._v(" "),s("p",[t._v("如果一个操作需要另一个操作先完成则可以通过  "),s("code",[t._v("addDependency")]),t._v("  设置依赖。添加依赖需要在添加到队列前执行")]),t._v(" "),s("tabs",{attrs:{"cache-lifetime":"10",options:{useUrlFragment:!1}}},[s("tab",{attrs:{name:"Objective-C",id:"first-tab"}},[s("div",{staticClass:"language-objectivec line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-objectivec"}},[s("code",[t._v("NSBlockOperation "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("operationA "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NSBlockOperation blockOperationWithBlock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nNSBlockOperation "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("operationB "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NSBlockOperation blockOperationWithBlock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// A 依赖于 B 先执行")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("operationA addDependency"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("operationB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])])]),t._v(" "),s("tab",{attrs:{name:"Swift",id:"second-tab"}},[s("div",{staticClass:"language-swift line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-swift"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" operationA "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("BlockOperation")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" operationB "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("BlockOperation")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// A 依赖于 B 先执行")]),t._v("\noperationA"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addDependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("operationB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])])])],1),t._v(" "),s("div",{staticClass:"custom-block danger"},[s("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),s("p",[t._v("不能循环建立操作间依赖关系，否则队列不调度操作执行")])])],1)}),[],!1,null,null,null);a.default=n.exports}}]);